{"version":3,"sources":["modules/router-store/router-store.umd.js"],"names":["global","factory","exports","module","require","define","amd","ngrx","routerStore","ng","core","router","rxjs","this","store","RouterStateSerializer","DefaultRouterStateSerializer","prototype","serialize","routerState","root","serializeRoute","url","route","_this","children","map","c","params","paramMap","data","outlet","routeConfig","component","undefined","queryParams","queryParamMap","fragment","parent","firstChild","pathFromRoot","__assign","Object","assign","t","s","i","n","arguments","length","p","hasOwnProperty","call","_ROUTER_CONFIG","InjectionToken","ROUTER_CONFIG","DEFAULT_ROUTER_FEATURENAME","_createDefaultRouterConfig","config","_config","stateKey","ɵ0","StoreRouterConnectingModule","store$$1","router$$1","serializer","dispatchTriggeredByRouter","navigationTriggeredByDispatch","setUpBeforePreactivationHook","setUpStoreStateListener","setUpStateRollbackEvents","forRoot","ngModule","providers","provide","useValue","useFactory","deps","hooks","beforePreactivation","shouldDispatchRouterNavigation","dispatchRouterNavigation","of","subscribe","storeState","pipe","select","navigateIfNeeded","state","navigateByUrl","events","e","RoutesRecognized","lastRoutesRecognized","NavigationCancel","dispatchRouterCancel","NavigationError","dispatchRouterError","NavigationEnd","dispatchRouterAction","event","id","urlAfterRedirects","type","payload","dispatch","decorators","NgModule","args","useClass","ctorParameters","Store","Router","Inject","ɵngrx_modules_router_store_router_store_a","ɵngrx_modules_router_store_router_store_b","ROUTER_ERROR","ROUTER_CANCEL","ROUTER_NAVIGATION","routerReducer","action","navigationId","defineProperty","value"],"mappings":";;;;;CAKC,SAAUA,EAAQC,GACI,iBAAZC,SAA0C,oBAAXC,OAAyBF,EAAQC,QAASE,QAAQ,iBAAkBA,QAAQ,mBAAoBA,QAAQ,eAAgBA,QAAQ,SACpJ,mBAAXC,QAAyBA,OAAOC,IAAMD,OAAO,sBAAuB,UAAW,gBAAiB,kBAAmB,cAAe,QAASJ,GACjJA,GAASD,EAAOO,KAAOP,EAAOO,SAAYP,EAAOO,KAAKC,gBAAkBR,EAAOS,GAAGC,KAAKV,EAAOS,GAAGE,OAAOX,EAAO,eAAeA,EAAOY,MAH1I,CAIEC,KAAM,SAAWX,EAAQQ,EAAKC,EAAOG,EAAMF,GAAQ,aAEjD,IAAIG,EACA,SAASA,MAITC,EAA8C,WAC9C,SAASA,KAiCT,OA/BAA,EAA6BC,UAAUC,UAAY,SAAUC,GACzD,OACIC,KAAMP,KAAKQ,eAAeF,EAAYC,MACtCE,IAAKH,EAAYG,MAGzBN,EAA6BC,UAAUI,eAAiB,SAAUE,GAC9D,IAAIC,EAAQX,KACRY,EAAWF,EAAME,SAASC,IAAI,SAAUC,GAAK,OAAOH,EAAMH,eAAeM,KAC7E,OACIC,OAAQL,EAAMK,OACdC,SAAUN,EAAMM,SAChBC,KAAMP,EAAMO,KACZR,IAAKC,EAAMD,IACXS,OAAQR,EAAMQ,OACdC,aACIC,UAAWV,EAAMS,YAAcT,EAAMS,YAAYC,eAAYC,GAEjEC,YAAaZ,EAAMY,YACnBC,cAAeb,EAAMa,cACrBC,SAAUd,EAAMc,SAChBJ,UAAYV,EAAMS,YACZT,EAAMS,YAAYC,eAClBC,EACNd,UAAMc,EACNI,YAAQJ,EACRK,WAAYd,EAAS,GACrBe,kBAAcN,EACdT,SAAUA,IAGXT,EAlCsC,GAqC7CyB,EAAgDC,OAAOC,QAAU,SAASC,GAC1E,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAII,KADTL,EAAIG,UAAUF,GACOJ,OAAOzB,UAAUkC,eAAeC,KAAKP,EAAGK,KACzDN,EAAEM,GAAKL,EAAEK,IAEjB,OAAON,GA2BPS,EAAiB,IAAI3C,EAAK4C,eAAe,6CACzCC,EAAgB,IAAI7C,EAAK4C,eAAe,oCACxCE,EAA6B,gBACjC,SAASC,EAA2BC,GAChC,IAAIC,EAOJ,OALIA,EADkB,mBAAXD,EACGA,IAGAA,MAEPjB,GAAWmB,SAAUJ,GAA8BG,GAE9D,IAAIE,GAAOD,SAAUJ,GA2CjBM,EAA6C,WAC7C,SAASA,EAA4BC,EAAUC,EAAWC,EAAYP,GAClE7C,KAAKC,MAAQiD,EACblD,KAAKF,OAASqD,EACdnD,KAAKoD,WAAaA,EAClBpD,KAAK6C,OAASA,EACd7C,KAAKqD,2BAA4B,EACjCrD,KAAKsD,+BAAgC,EACrCtD,KAAK+C,SAAW/C,KAAK6C,OAAOE,SAC5B/C,KAAKuD,+BACLvD,KAAKwD,0BACLxD,KAAKyD,2BA2HT,OAzHAR,EAA4BS,QAAU,SAAUb,GAE5C,YADe,IAAXA,IAAqBA,OAErBc,SAAUV,EACVW,YACMC,QAASrB,EAAgBsB,SAAUjB,IAEjCgB,QAASnB,EACTqB,WAAYnB,EACZoB,MAAOxB,OAKvBS,EAA4B7C,UAAUmD,6BAA+B,WACjE,IAAI5C,EAAQX,KACZA,KAAKF,OAAOmE,MAAMC,oBAAsB,SAAU5D,GAK9C,OAJAK,EAAML,YAAcK,EAAMyC,WAAW/C,UAAUC,GAC3CK,EAAMwD,kCACNxD,EAAMyD,2BAEHrE,EAAKsE,IAAG,KAGvBpB,EAA4B7C,UAAUoD,wBAA0B,WAC5D,IAAI7C,EAAQX,KACZA,KAAKC,MAAMqE,UAAU,SAAUtC,GAC3BrB,EAAM4D,WAAavC,IAEvBhC,KAAKC,MAAMuE,KAAKvE,EAAMwE,OAAOzE,KAAK+C,WAAWuB,UAAU,WACnD3D,EAAM+D,sBAGdzB,EAA4B7C,UAAU+D,+BAAiC,WACnE,OAAKnE,KAAKuE,WAAWvE,KAAK+C,YAElB/C,KAAKsD,+BAEjBL,EAA4B7C,UAAUsE,iBAAmB,WAChD1E,KAAKuE,WAAWvE,KAAK+C,WACrB/C,KAAKuE,WAAWvE,KAAK+C,UAAU4B,QAGhC3E,KAAKqD,2BAELrD,KAAKF,OAAOW,MAAQT,KAAKuE,WAAWvE,KAAK+C,UAAU4B,MAAMlE,MACzDT,KAAKsD,+BAAgC,EACrCtD,KAAKF,OAAO8E,cAAc5E,KAAKuE,WAAWvE,KAAK+C,UAAU4B,MAAMlE,QAGvEwC,EAA4B7C,UAAUqD,yBAA2B,WAC7D,IAAI9C,EAAQX,KACZA,KAAKF,OAAO+E,OAAOP,UAAU,SAAUQ,GAC/BA,aAAahF,EAAOiF,iBACpBpE,EAAMqE,qBAAuBF,EAExBA,aAAahF,EAAOmF,iBACzBtE,EAAMuE,qBAAqBJ,GAEtBA,aAAahF,EAAOqF,gBACzBxE,EAAMyE,oBAAoBN,GAErBA,aAAahF,EAAOuF,gBACzB1E,EAAM0C,2BAA4B,EAClC1C,EAAM2C,+BAAgC,MAIlDL,EAA4B7C,UAAUgE,yBAA2B,WAC7DpE,KAAKsF,qBAhKW,qBAiKZhF,YAAaN,KAAKM,YAClBiF,MAAO,IAAIzF,EAAOiF,iBAAiB/E,KAAKgF,qBAAqBQ,GAAIxF,KAAKgF,qBAAqBvE,IAAKT,KAAKgF,qBAAqBS,kBAAmBzF,KAAKM,gBAG1J2C,EAA4B7C,UAAU8E,qBAAuB,SAAUK,GACnEvF,KAAKsF,qBAlKO,iBAmKRhF,YAAaN,KAAKM,YAClBiE,WAAYvE,KAAKuE,WACjBgB,MAAOA,KAGftC,EAA4B7C,UAAUgF,oBAAsB,SAAUG,GAClEvF,KAAKsF,qBArKM,eAsKPhF,YAAaN,KAAKM,YAClBiE,WAAYvE,KAAKuE,WACjBgB,MAAO,IAAIzF,EAAOqF,gBAAgBI,EAAMC,GAAID,EAAM9E,IAAK,GAAK8E,MAGpEtC,EAA4B7C,UAAUkF,qBAAuB,SAAUI,EAAMC,GACzE3F,KAAKqD,2BAA4B,EACjC,IACIrD,KAAKC,MAAM2F,UAAWF,KAAMA,EAAMC,QAASA,IAE/C,QACI3F,KAAKqD,2BAA4B,EACjCrD,KAAKsD,+BAAgC,IAG7CL,EAA4B4C,aACtBH,KAAM7F,EAAKiG,SAAUC,OACXnC,YACMC,QAAS3D,EAAuB8F,SAAU7F,IAExC0D,QAASrB,EACTsB,SAAUd,IAGVa,QAASnB,EACTqB,WAAYnB,EACZoB,MAAOxB,SAM/BS,EAA4BgD,eAAiB,WAAc,QACrDP,KAAMzF,EAAMiG,QACZR,KAAM5F,EAAOqG,SACbT,KAAMxF,IACNwF,UAAMrE,EAAWwE,aAAeH,KAAM7F,EAAKuG,OAAQL,MAAOrD,QAEzDO,EAtIqC,GAmJhD5D,EAAQgH,0CAA4C7D,EACpDnD,EAAQiH,0CAA4C1D,EACpDvD,EAAQkH,aA3NW,cA4NnBlH,EAAQmH,cAhOY,gBAiOpBnH,EAAQoH,kBArOgB,oBAsOxBpH,EAAQqH,cA7NR,SAASA,EAAc/B,EAAOgC,GAC1B,OAAQA,EAAOjB,MACX,IAXgB,oBAYhB,IAJW,cAKX,IATY,gBAUR,OACIf,MAAOgC,EAAOhB,QAAQrF,YACtBsG,aAAcD,EAAOhB,QAAQJ,MAAMC,IAE3C,QACI,OAAOb,IAoNnBtF,EAAQ4D,4BAA8BA,EACtC5D,EAAQqD,cAAgBA,EACxBrD,EAAQsD,2BAA6BA,EACrCtD,EAAQa,sBAAwBA,EAChCb,EAAQc,6BAA+BA,EAEvC0B,OAAOgF,eAAexH,EAAS,cAAgByH,OAAO","sourcesContent":["/**\n * @license NgRx 6.1.0\n * (c) 2015-2018 Brandon Roberts, Mike Ryan, Rob Wormald, Victor Savkin\n * License: MIT\n */\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core'), require('@angular/router'), require('@ngrx/store'), require('rxjs')) :\n    typeof define === 'function' && define.amd ? define('@ngrx/router-store', ['exports', '@angular/core', '@angular/router', '@ngrx/store', 'rxjs'], factory) :\n    (factory((global.ngrx = global.ngrx || {}, global.ngrx.routerStore = {}),global.ng.core,global.ng.router,global['@ngrx/store'],global.rxjs));\n}(this, (function (exports,core,router,store,rxjs) { 'use strict';\n\n    var RouterStateSerializer = /** @class */ (function () {\n        function RouterStateSerializer() {\n        }\n        return RouterStateSerializer;\n    }());\n    var DefaultRouterStateSerializer = /** @class */ (function () {\n        function DefaultRouterStateSerializer() {\n        }\n        DefaultRouterStateSerializer.prototype.serialize = function (routerState) {\n            return {\n                root: this.serializeRoute(routerState.root),\n                url: routerState.url,\n            };\n        };\n        DefaultRouterStateSerializer.prototype.serializeRoute = function (route) {\n            var _this = this;\n            var children = route.children.map(function (c) { return _this.serializeRoute(c); });\n            return {\n                params: route.params,\n                paramMap: route.paramMap,\n                data: route.data,\n                url: route.url,\n                outlet: route.outlet,\n                routeConfig: {\n                    component: route.routeConfig ? route.routeConfig.component : undefined,\n                },\n                queryParams: route.queryParams,\n                queryParamMap: route.queryParamMap,\n                fragment: route.fragment,\n                component: (route.routeConfig\n                    ? route.routeConfig.component\n                    : undefined),\n                root: undefined,\n                parent: undefined,\n                firstChild: children[0],\n                pathFromRoot: undefined,\n                children: children,\n            };\n        };\n        return DefaultRouterStateSerializer;\n    }());\n\n    var __assign = (undefined && undefined.__assign) || Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    /**\n     * An action dispatched when the router navigates.\n     */\n    var ROUTER_NAVIGATION = 'ROUTER_NAVIGATION';\n    /**\n     * An action dispatched when the router cancels navigation.\n     */\n    var ROUTER_CANCEL = 'ROUTER_CANCEL';\n    /**\n     * An action dispatched when the router errors.\n     */\n    var ROUTER_ERROR = 'ROUTE_ERROR';\n    function routerReducer(state, action) {\n        switch (action.type) {\n            case ROUTER_NAVIGATION:\n            case ROUTER_ERROR:\n            case ROUTER_CANCEL:\n                return {\n                    state: action.payload.routerState,\n                    navigationId: action.payload.event.id,\n                };\n            default:\n                return state;\n        }\n    }\n    var _ROUTER_CONFIG = new core.InjectionToken('@ngrx/router-store Internal Configuration');\n    var ROUTER_CONFIG = new core.InjectionToken('@ngrx/router-store Configuration');\n    var DEFAULT_ROUTER_FEATURENAME = 'routerReducer';\n    function _createDefaultRouterConfig(config) {\n        var _config;\n        if (typeof config === 'function') {\n            _config = config();\n        }\n        else {\n            _config = config || {};\n        }\n        return __assign({ stateKey: DEFAULT_ROUTER_FEATURENAME }, _config);\n    }\n    var ɵ0 = { stateKey: DEFAULT_ROUTER_FEATURENAME };\n    /**\n     * Connects RouterModule with StoreModule.\n     *\n     * During the navigation, before any guards or resolvers run, the router will dispatch\n     * a ROUTER_NAVIGATION action, which has the following signature:\n     *\n     * ```\n     * export type RouterNavigationPayload = {\n     *   routerState: SerializedRouterStateSnapshot,\n     *   event: RoutesRecognized\n     * }\n     * ```\n     *\n     * Either a reducer or an effect can be invoked in response to this action.\n     * If the invoked reducer throws, the navigation will be canceled.\n     *\n     * If navigation gets canceled because of a guard, a ROUTER_CANCEL action will be\n     * dispatched. If navigation results in an error, a ROUTER_ERROR action will be dispatched.\n     *\n     * Both ROUTER_CANCEL and ROUTER_ERROR contain the store state before the navigation\n     * which can be used to restore the consistency of the store.\n     *\n     * Usage:\n     *\n     * ```typescript\n     * @NgModule({\n     *   declarations: [AppCmp, SimpleCmp],\n     *   imports: [\n     *     BrowserModule,\n     *     StoreModule.forRoot(mapOfReducers),\n     *     RouterModule.forRoot([\n     *       { path: '', component: SimpleCmp },\n     *       { path: 'next', component: SimpleCmp }\n     *     ]),\n     *     StoreRouterConnectingModule\n     *   ],\n     *   bootstrap: [AppCmp]\n     * })\n     * export class AppModule {\n     * }\n     * ```\n     */\n    var StoreRouterConnectingModule = /** @class */ (function () {\n        function StoreRouterConnectingModule(store$$1, router$$1, serializer, config) {\n            this.store = store$$1;\n            this.router = router$$1;\n            this.serializer = serializer;\n            this.config = config;\n            this.dispatchTriggeredByRouter = false;\n            this.navigationTriggeredByDispatch = false;\n            this.stateKey = this.config.stateKey;\n            this.setUpBeforePreactivationHook();\n            this.setUpStoreStateListener();\n            this.setUpStateRollbackEvents();\n        }\n        StoreRouterConnectingModule.forRoot = function (config) {\n            if (config === void 0) { config = {}; }\n            return {\n                ngModule: StoreRouterConnectingModule,\n                providers: [\n                    { provide: _ROUTER_CONFIG, useValue: config },\n                    {\n                        provide: ROUTER_CONFIG,\n                        useFactory: _createDefaultRouterConfig,\n                        deps: [_ROUTER_CONFIG],\n                    },\n                ],\n            };\n        };\n        StoreRouterConnectingModule.prototype.setUpBeforePreactivationHook = function () {\n            var _this = this;\n            this.router.hooks.beforePreactivation = function (routerState) {\n                _this.routerState = _this.serializer.serialize(routerState);\n                if (_this.shouldDispatchRouterNavigation()) {\n                    _this.dispatchRouterNavigation();\n                }\n                return rxjs.of(true);\n            };\n        };\n        StoreRouterConnectingModule.prototype.setUpStoreStateListener = function () {\n            var _this = this;\n            this.store.subscribe(function (s) {\n                _this.storeState = s;\n            });\n            this.store.pipe(store.select(this.stateKey)).subscribe(function () {\n                _this.navigateIfNeeded();\n            });\n        };\n        StoreRouterConnectingModule.prototype.shouldDispatchRouterNavigation = function () {\n            if (!this.storeState[this.stateKey])\n                return true;\n            return !this.navigationTriggeredByDispatch;\n        };\n        StoreRouterConnectingModule.prototype.navigateIfNeeded = function () {\n            if (!this.storeState[this.stateKey] ||\n                !this.storeState[this.stateKey].state) {\n                return;\n            }\n            if (this.dispatchTriggeredByRouter)\n                return;\n            if (this.router.url !== this.storeState[this.stateKey].state.url) {\n                this.navigationTriggeredByDispatch = true;\n                this.router.navigateByUrl(this.storeState[this.stateKey].state.url);\n            }\n        };\n        StoreRouterConnectingModule.prototype.setUpStateRollbackEvents = function () {\n            var _this = this;\n            this.router.events.subscribe(function (e) {\n                if (e instanceof router.RoutesRecognized) {\n                    _this.lastRoutesRecognized = e;\n                }\n                else if (e instanceof router.NavigationCancel) {\n                    _this.dispatchRouterCancel(e);\n                }\n                else if (e instanceof router.NavigationError) {\n                    _this.dispatchRouterError(e);\n                }\n                else if (e instanceof router.NavigationEnd) {\n                    _this.dispatchTriggeredByRouter = false;\n                    _this.navigationTriggeredByDispatch = false;\n                }\n            });\n        };\n        StoreRouterConnectingModule.prototype.dispatchRouterNavigation = function () {\n            this.dispatchRouterAction(ROUTER_NAVIGATION, {\n                routerState: this.routerState,\n                event: new router.RoutesRecognized(this.lastRoutesRecognized.id, this.lastRoutesRecognized.url, this.lastRoutesRecognized.urlAfterRedirects, this.routerState),\n            });\n        };\n        StoreRouterConnectingModule.prototype.dispatchRouterCancel = function (event) {\n            this.dispatchRouterAction(ROUTER_CANCEL, {\n                routerState: this.routerState,\n                storeState: this.storeState,\n                event: event,\n            });\n        };\n        StoreRouterConnectingModule.prototype.dispatchRouterError = function (event) {\n            this.dispatchRouterAction(ROUTER_ERROR, {\n                routerState: this.routerState,\n                storeState: this.storeState,\n                event: new router.NavigationError(event.id, event.url, \"\" + event),\n            });\n        };\n        StoreRouterConnectingModule.prototype.dispatchRouterAction = function (type, payload) {\n            this.dispatchTriggeredByRouter = true;\n            try {\n                this.store.dispatch({ type: type, payload: payload });\n            }\n            finally {\n                this.dispatchTriggeredByRouter = false;\n                this.navigationTriggeredByDispatch = false;\n            }\n        };\n        StoreRouterConnectingModule.decorators = [\n            { type: core.NgModule, args: [{\n                        providers: [\n                            { provide: RouterStateSerializer, useClass: DefaultRouterStateSerializer },\n                            {\n                                provide: _ROUTER_CONFIG,\n                                useValue: ɵ0,\n                            },\n                            {\n                                provide: ROUTER_CONFIG,\n                                useFactory: _createDefaultRouterConfig,\n                                deps: [_ROUTER_CONFIG],\n                            },\n                        ],\n                    },] }\n        ];\n        /** @nocollapse */\n        StoreRouterConnectingModule.ctorParameters = function () { return [\n            { type: store.Store, },\n            { type: router.Router, },\n            { type: RouterStateSerializer, },\n            { type: undefined, decorators: [{ type: core.Inject, args: [ROUTER_CONFIG,] },] },\n        ]; };\n        return StoreRouterConnectingModule;\n    }());\n\n    /**\n     * DO NOT EDIT\n     *\n     * This file is automatically generated at build\n     */\n\n    /**\n     * Generated bundle index. Do not edit.\n     */\n\n    exports.ɵngrx_modules_router_store_router_store_a = _ROUTER_CONFIG;\n    exports.ɵngrx_modules_router_store_router_store_b = _createDefaultRouterConfig;\n    exports.ROUTER_ERROR = ROUTER_ERROR;\n    exports.ROUTER_CANCEL = ROUTER_CANCEL;\n    exports.ROUTER_NAVIGATION = ROUTER_NAVIGATION;\n    exports.routerReducer = routerReducer;\n    exports.StoreRouterConnectingModule = StoreRouterConnectingModule;\n    exports.ROUTER_CONFIG = ROUTER_CONFIG;\n    exports.DEFAULT_ROUTER_FEATURENAME = DEFAULT_ROUTER_FEATURENAME;\n    exports.RouterStateSerializer = RouterStateSerializer;\n    exports.DefaultRouterStateSerializer = DefaultRouterStateSerializer;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=router-store.umd.js.map\n"]}