/**
 * @license NgRx 6.1.0
 * (c) 2015-2018 Brandon Roberts, Mike Ryan, Rob Wormald, Victor Savkin
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/router"),require("@ngrx/store"),require("rxjs")):"function"==typeof define&&define.amd?define("@ngrx/router-store",["exports","@angular/core","@angular/router","@ngrx/store","rxjs"],e):e((t.ngrx=t.ngrx||{},t.ngrx.routerStore={}),t.ng.core,t.ng.router,t["@ngrx/store"],t.rxjs)}(this,function(t,e,r,o,i){"use strict";var a=function a(){},n=function(){function t(){}return t.prototype.serialize=function(t){return{root:this.serializeRoute(t.root),url:t.url}},t.prototype.serializeRoute=function(t){var e=this,r=t.children.map(function(t){return e.serializeRoute(t)});return{params:t.params,paramMap:t.paramMap,data:t.data,url:t.url,outlet:t.outlet,routeConfig:{component:t.routeConfig?t.routeConfig.component:void 0},queryParams:t.queryParams,queryParamMap:t.queryParamMap,fragment:t.fragment,component:t.routeConfig?t.routeConfig.component:void 0,root:void 0,parent:void 0,firstChild:r[0],pathFromRoot:void 0,children:r}},t}(),s=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},u=new e.InjectionToken("@ngrx/router-store Internal Configuration"),c=new e.InjectionToken("@ngrx/router-store Configuration"),p="routerReducer";function d(t){var e;return e="function"==typeof t?t():t||{},s({stateKey:p},e)}var h={stateKey:p},R=function(){function t(t,e,r,o){this.store=t,this.router=e,this.serializer=r,this.config=o,this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1,this.stateKey=this.config.stateKey,this.setUpBeforePreactivationHook(),this.setUpStoreStateListener(),this.setUpStateRollbackEvents()}return t.forRoot=function(e){return void 0===e&&(e={}),{ngModule:t,providers:[{provide:u,useValue:e},{provide:c,useFactory:d,deps:[u]}]}},t.prototype.setUpBeforePreactivationHook=function(){var t=this;this.router.hooks.beforePreactivation=function(e){return t.routerState=t.serializer.serialize(e),t.shouldDispatchRouterNavigation()&&t.dispatchRouterNavigation(),i.of(!0)}},t.prototype.setUpStoreStateListener=function(){var t=this;this.store.subscribe(function(e){t.storeState=e}),this.store.pipe(o.select(this.stateKey)).subscribe(function(){t.navigateIfNeeded()})},t.prototype.shouldDispatchRouterNavigation=function(){return!this.storeState[this.stateKey]||!this.navigationTriggeredByDispatch},t.prototype.navigateIfNeeded=function(){this.storeState[this.stateKey]&&this.storeState[this.stateKey].state&&(this.dispatchTriggeredByRouter||this.router.url!==this.storeState[this.stateKey].state.url&&(this.navigationTriggeredByDispatch=!0,this.router.navigateByUrl(this.storeState[this.stateKey].state.url)))},t.prototype.setUpStateRollbackEvents=function(){var t=this;this.router.events.subscribe(function(e){e instanceof r.RoutesRecognized?t.lastRoutesRecognized=e:e instanceof r.NavigationCancel?t.dispatchRouterCancel(e):e instanceof r.NavigationError?t.dispatchRouterError(e):e instanceof r.NavigationEnd&&(t.dispatchTriggeredByRouter=!1,t.navigationTriggeredByDispatch=!1)})},t.prototype.dispatchRouterNavigation=function(){this.dispatchRouterAction("ROUTER_NAVIGATION",{routerState:this.routerState,event:new r.RoutesRecognized(this.lastRoutesRecognized.id,this.lastRoutesRecognized.url,this.lastRoutesRecognized.urlAfterRedirects,this.routerState)})},t.prototype.dispatchRouterCancel=function(t){this.dispatchRouterAction("ROUTER_CANCEL",{routerState:this.routerState,storeState:this.storeState,event:t})},t.prototype.dispatchRouterError=function(t){this.dispatchRouterAction("ROUTE_ERROR",{routerState:this.routerState,storeState:this.storeState,event:new r.NavigationError(t.id,t.url,""+t)})},t.prototype.dispatchRouterAction=function(t,e){this.dispatchTriggeredByRouter=!0;try{this.store.dispatch({type:t,payload:e})}finally{this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1}},t.decorators=[{type:e.NgModule,args:[{providers:[{provide:a,useClass:n},{provide:u,useValue:h},{provide:c,useFactory:d,deps:[u]}]}]}],t.ctorParameters=function(){return[{type:o.Store},{type:r.Router},{type:a},{type:void 0,decorators:[{type:e.Inject,args:[c]}]}]},t}();t.ɵngrx_modules_router_store_router_store_a=u,t.ɵngrx_modules_router_store_router_store_b=d,t.ROUTER_ERROR="ROUTE_ERROR",t.ROUTER_CANCEL="ROUTER_CANCEL",t.ROUTER_NAVIGATION="ROUTER_NAVIGATION",t.routerReducer=function g(t,e){switch(e.type){case"ROUTER_NAVIGATION":case"ROUTE_ERROR":case"ROUTER_CANCEL":return{state:e.payload.routerState,navigationId:e.payload.event.id};default:return t}},t.StoreRouterConnectingModule=R,t.ROUTER_CONFIG=c,t.DEFAULT_ROUTER_FEATURENAME=p,t.RouterStateSerializer=a,t.DefaultRouterStateSerializer=n,Object.defineProperty(t,"__esModule",{value:!0})});